From 9e1223c462cced89dd6529bdc3580f0e8ec5944b Mon Sep 17 00:00:00 2001
From: Kyle Anderson <kyle@xkyle.com>
Date: Sat, 23 Mar 2013 13:44:41 -0700
Subject: [PATCH] Added OpenWrt (19676) ps detection and unit test for ps fact

---
 lib/facter/ps.rb     |    5 +++++
 spec/unit/ps_spec.rb |   42 ++++++++++++++++++++++++++++++++++++++++++
 2 files changed, 47 insertions(+)
 create mode 100755 spec/unit/ps_spec.rb

diff --git a/lib/facter/ps.rb b/lib/facter/ps.rb
index 5d8cb0a..5fb2984 100644
--- a/lib/facter/ps.rb
+++ b/lib/facter/ps.rb
@@ -15,6 +15,11 @@ Facter.add(:ps) do
 end
 
 Facter.add(:ps) do
+  confine :operatingsystem => :OpenWrt
+  setcode do 'ps www' end
+end
+
+Facter.add(:ps) do
   confine :operatingsystem => %w{FreeBSD NetBSD OpenBSD Darwin DragonFly}
   setcode do 'ps auxwww' end
 end
diff --git a/spec/unit/ps_spec.rb b/spec/unit/ps_spec.rb
new file mode 100755
index 0000000..2e25a4b
--- /dev/null
+++ b/spec/unit/ps_spec.rb
@@ -0,0 +1,42 @@
+#! /usr/bin/env ruby
+
+require 'spec_helper'
+
+describe "ps facts" do
+
+  it "should return busybox style ps www on OpenWrt" do
+    Facter.fact(:operatingsystem).stubs(:value).returns 'OpenWrt'
+    Facter.fact(:ps).value.should == 'ps www'
+  end
+
+  [
+    'FreeBSD',
+    'NetBSD',
+    'OpenBSD',
+    'Darwin',
+    'DragonFly'
+  ].each do |os|
+    it "should return unix style ps on operatingsystem #{os}" do
+      Facter.fact(:operatingsystem).stubs(:value).returns os
+      Facter.fact(:ps).value.should == 'ps auxwww'
+    end
+  end
+
+  # Other Linux Distros should return a ps -ef
+  [
+    'RedHat',
+    'Debian',
+  ].each do |os|
+    it "should return gnu/linux style ps -ef on operatingsystem #{os}" do
+      Facter.fact(:operatingsystem).stubs(:value).returns os
+      Facter.fact(:ps).value.should == 'ps -ef'
+    end
+  end
+
+  it "should return tasklist.exe on Windows" do
+    Facter.fact(:operatingsystem).stubs(:value).returns 'windows'
+    Facter.fact(:ps).value.should == 'tasklist.exe'
+  end
+
+end
+
-- 
1.7.10.4

